<?xml version="1.0" standalone="yes"?>
<package version="2.1" displayname="Advanced Search Form" includeentityhelper="true" debug="false">

  <!-- ###################################################################################################### -->
  <!-- Licensed by Interprise Solutions.					                -->
  <!-- http://www.InterpriseSolutions.com														                -->
  <!-- For details on this license please visit  the product homepage at the URL above.		                -->
  <!-- THE ABOVE NOTICE MUST REMAIN INTACT.                                                                   -->
  <!-- ###################################################################################################### -->

  <query name="ItemTypes" rowElementName="ItemType">
    <sql>
      <![CDATA[ 
            SELECT DISTINCT ItemType FROM InventoryItem with (NOLOCK) WHERE ItemType NOT IN ('Matrix Item')
        ]]>
    </sql>
  </query>
  <query name="UnitMeasures" rowElementName="UnitMeasure">
    <sql>
      <![CDATA[ 
            SELECT Counter as UnitMeasureID, UnitMeasureCode, UnitMeasureDescription FROM SystemUnitMeasure with (NOLOCK) WHERE IsActive = 1
        ]]>
    </sql>
  </query>
  <query name="Products" rowElementName="Product" runif="SearchTerm">
    <sql>
      <![CDATA[ 
            exec eCommerceSearchInventory @SearchTerm, @WebSiteCode, @LanguageCode, NULL, @ItemType, @UnitMeasure, @CategoryID, @SectionID, @ManufacturerID, @AttributeID, @SearchDescriptions, @CurrentDate, @ProductFilterID, @ContactCode, @CBMode
          ]]>
    </sql>
    <queryparam paramname="@SearchTerm" paramtype="request" requestparamname="SearchTerm" sqlDataType="varchar" defvalue="" validationpattern="" />
    <queryparam paramname="@WebSiteCode" paramtype="runtime" requestparamname="WebSiteCode" sqlDataType="varchar" defvalue="" validationpattern="" />
    <queryparam paramname="@LanguageCode" paramtype="runtime" requestparamname="LanguageCode" sqlDataType="varchar" defvalue="" validationpattern="" />
    <queryparam paramname="@ItemType" paramtype="request" requestparamname="ItemType" sqlDataType="varchar" defvalue="" validationpattern="" />
    <queryparam paramname="@UnitMeasure" paramtype="request" requestparamname="UnitMeasure" sqlDataType="varchar" defvalue="" validationpattern="" />
    <queryparam paramname="@CategoryID" paramtype="request" requestparamname="CategoryID" sqlDataType="varchar" defvalue="" validationpattern="" />
    <queryparam paramname="@SectionID" paramtype="request" requestparamname="SectionID" sqlDataType="varchar" defvalue="" validationpattern="" />
    <queryparam paramname="@ManufacturerID" paramtype="request" requestparamname="ManufacturerID" sqlDataType="varchar" defvalue="" validationpattern="" />
    <queryparam paramname="@AttributeID" paramtype="request" requestparamname="AttributeID" sqlDataType="varchar" defvalue="" validationpattern="" />
    <queryparam paramname="@SearchDescriptions" paramtype="request" requestparamname="SearchDescriptions" sqlDataType="varchar" defvalue="" validationpattern="" />
    <queryparam paramname="@CurrentDate" paramtype="runtime" requestparamname="Date" sqlDataType="datetime" defvalue="0" validationpattern="" />
    <queryparam paramname="@ProductFilterID" paramtype="runtime" requestparamname="ProductFilterID" sqlDataType="nvarchar" defvalue="" validationpattern="" />
    <queryparam paramname="@ContactCode" paramtype="runtime" requestparamname="ContactCode" sqlDataType="nvarchar" defvalue="" validationpattern="" />
    <queryparam paramname="@CBMode" paramtype="runtime" requestparamname="CBNMode" sqlDataType="bit" defvalue="0" validationpattern="" />
  </query>
  <query name="Categories" rowElementName="Category" runif="SearchTerm">
    <sql>
      <![CDATA[
                exec eCommerceSearchCategories @SearchTerm, @WebSiteCode, @LanguageCode, @CategoryID
      ]]>
    </sql>
    <queryparam paramname="@SearchTerm" paramtype="request" requestparamname="SearchTerm" sqlDataType="varchar" defvalue="" validationpattern="" />
    <queryparam paramname="@WebSiteCode" paramtype="runtime" requestparamname="WebSiteCode" sqlDataType="varchar" defvalue="" validationpattern="" />
    <queryparam paramname="@LanguageCode" paramtype="runtime" requestparamname="LanguageCode" sqlDataType="varchar" defvalue="" validationpattern="" />
    <queryparam paramname="@CategoryID" paramtype="request" requestparamname="CategoryID" sqlDataType="int" defvalue="0" validationpattern="" />
  </query>
  <query name="Departments" rowElementName="Department" runif="SearchTerm">
    <sql>
      <![CDATA[
            exec eCommerceSearchDepartments @SearchTerm, @WebSiteCode, @LanguageCode, @SectionID
            ]]>
    </sql>
    <queryparam paramname="@SearchTerm" paramtype="request" requestparamname="SearchTerm" sqlDataType="varchar" defvalue="" validationpattern="" />
    <queryparam paramname="@WebSiteCode" paramtype="runtime" requestparamname="WebSiteCode" sqlDataType="varchar" defvalue="" validationpattern="" />
    <queryparam paramname="@LanguageCode" paramtype="runtime" requestparamname="LanguageCode" sqlDataType="varchar" defvalue="" validationpattern="" />
    <queryparam paramname="@SectionID" paramtype="request" requestparamname="SectionID" sqlDataType="int" defvalue="0" validationpattern="" />
  </query>
  <query name="Manufacturers" rowElementName="Manufacturer" runif="SearchTerm">
    <sql>
      <![CDATA[
            exec eCommerceSearchManufacturers @SearchTerm, @WebSiteCode, @LanguageCode, @ManufacturerID
            ]]>
    </sql>
    <queryparam paramname="@SearchTerm" paramtype="request" requestparamname="SearchTerm" sqlDataType="varchar" defvalue="" validationpattern="" />
    <queryparam paramname="@WebSiteCode" paramtype="runtime" requestparamname="WebSiteCode" sqlDataType="varchar" defvalue="" validationpattern="" />
    <queryparam paramname="@LanguageCode" paramtype="runtime" requestparamname="LanguageCode" sqlDataType="varchar" defvalue="" validationpattern="" />
    <queryparam paramname="@ManufacturerID" paramtype="request" requestparamname="ManufacturerID" sqlDataType="int" defvalue="0" validationpattern="" />
  </query>
    <query name="Attributes" rowElementName="Attribute" runif="SearchTerm">
        <sql>
            <![CDATA[
            exec eCommerceSearchAttributes @SearchTerm, @LanguageCode, @WebSiteCode, @AttributeID
            ]]>
        </sql>
        <queryparam paramname="@SearchTerm" paramtype="request" requestparamname="SearchTerm" sqlDataType="varchar" defvalue="" validationpattern="" />        
        <queryparam paramname="@LanguageCode" paramtype="runtime" requestparamname="LanguageCode" sqlDataType="varchar" defvalue="" validationpattern="" />
      <queryparam paramname="@WebSiteCode" paramtype="runtime" requestparamname="WebSiteCode" sqlDataType="varchar" defvalue="" validationpattern="" />
        <queryparam paramname="@AttributeID" paramtype="request" requestparamname="AttributeID" sqlDataType="int" defvalue="0" validationpattern="" />
    </query>
  <PackageTransform debug="false">
    <xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" xmlns:ise="urn:ise" exclude-result-prefixes="ise">
      <xsl:output method="html" omit-xml-declaration="yes" />
      <xsl:param name="LocaleSetting" select="/root/Runtime/LocaleSetting" />
      <xsl:param name="WebConfigLocaleSetting" select="/root/Runtime/WebConfigLocaleSetting" />
      <xsl:param name="MinPrice">
        <xsl:choose>
          <xsl:when test="/root/QueryString/minprice!=''">
            <xsl:value-of select="/root/QueryString/minprice" />
          </xsl:when>
          <xsl:otherwise>0</xsl:otherwise>
        </xsl:choose>
      </xsl:param>
      <xsl:param name="MaxPrice">
        <xsl:choose>
          <xsl:when test="/root/QueryString/maxprice!=''">
            <xsl:value-of select="/root/QueryString/maxprice" />
          </xsl:when>
          <xsl:otherwise>9999999999</xsl:otherwise>
        </xsl:choose>
      </xsl:param>
      <xsl:template match="/">
        <xsl:value-of select="ise:Topic('SearchPageHeader')" disable-output-escaping="yes" />
        <script type="text/javascript" Language="JavaScript">
          function SearchForm2_Validator(theForm)
          {
          $disableSubmit(theForm);
          if (theForm.SearchTerm.value.length &lt; <xsl:value-of select="ise:AppConfig('MinSearchStringLength')" />)
          {
          alert('<xsl:value-of select="ise:StrFormatStringresourceTextOnly('search.aspx.2', ise:AppConfig('MinSearchStringLength'), ',')" disable-output-escaping="yes" />');
          theForm.SearchTerm.focus();
          $enableSubmit(theForm);
          return (false);
          }
          return (true);
          }
        </script>
        <form method="GET" action="searchadv.aspx" name="AdvSearchForm" id="AdvSearchForm">
          <p>
            <xsl:value-of select="ise:StringResource('searchadv.aspx.2', $LocaleSetting)" disable-output-escaping="yes" />
          </p>
          <table border="0" cellpadding="0" cellspacing="0" width="100%">
            <tr align="left">
              <td width="25%" align="right" valign="middle">
                <input type="hidden" name="IsSubmit" value="true" />
                <xsl:value-of select="ise:StringResource('searchadv.aspx.3', $LocaleSetting)" disable-output-escaping="yes" />&#0160;&#0160;
              </td>
              <td align="left">
                <input type="text" id="txtSearchTermAdvanced" name="SearchTerm" size="25" maxlength="70" value="{/root/QueryString/searchterm}" />
                <xsl:value-of select="ise:GetSearchFormValidatorScript('AdvSearchForm', 'txtSearchTermAdvanced')" disable-output-escaping="yes" />
              </td>
            </tr>
            <tr valign="middle">
              <td width="25%" align="right" valign="middle">
                <xsl:value-of select="ise:StringResource('searchadv.aspx.4', $LocaleSetting)" disable-output-escaping="yes" />&#0160;&#0160;
              </td>
              <td align="left">
                <xsl:value-of select="ise:StringResource('searchadv.aspx.5', $LocaleSetting)" disable-output-escaping="yes" />
                 <input TYPE="RADIO" NAME="SearchDescriptions" value="1">
                  <xsl:if test="/root/QueryString/searchdescriptions = 1">
                    <xsl:attribute name="checked">checked</xsl:attribute>
                  </xsl:if>
                </input>
                <xsl:value-of select="ise:StringResource('searchadv.aspx.6', $LocaleSetting)" disable-output-escaping="yes" />
                <input TYPE="RADIO" NAME="SearchDescriptions" value="0">
                  <xsl:if test="/root/QueryString/searchdescriptions = 0 or not(boolean(/root/QueryString/searchdescriptions))">
                    <xsl:attribute name="checked">checked</xsl:attribute>
                  </xsl:if>
                </input>
              </td>
            </tr>
            <xsl:if test="ise:AppConfigBool('SearchAdv_ShowProductType')='true'">
              <tr valign="middle">
                <td align="right" valign="middle">
                  <xsl:value-of select="ise:StringResource('searchadv.aspx.7', $LocaleSetting)" disable-output-escaping="yes" />&#0160;&#0160;
                </td>
                <td align="left">
                  <select size="1" name="ItemType">
                    <option value="ANY">
                      <xsl:value-of select="ise:StringResource('searchadv.aspx.8', $LocaleSetting)" disable-output-escaping="yes" />
                    </option>
                    <xsl:apply-templates select="/root/ItemTypes/ItemType" />
                  </select>
                </td>
              </tr>
            </xsl:if>
            <xsl:if test="ise:AppConfigBool('SearchAdv_ShowUnitMeasure')='true'">
              <tr valign="middle">
                <td align="right" valign="middle">
                  <xsl:value-of select="ise:StringResource('searchadv.aspx.16', $LocaleSetting)" disable-output-escaping="yes" />&#0160;&#0160;
                </td>
                <td align="left">
                  <select size="1" name="UnitMeasure">
                    <option value="ANY">
                      <xsl:value-of select="ise:StringResource('searchadv.aspx.8', $LocaleSetting)" disable-output-escaping="yes" />
                    </option>
                    <xsl:apply-templates select="/root/UnitMeasures/UnitMeasure" />
                  </select>
                </td>
              </tr>
            </xsl:if>
            <xsl:if test="ise:AppConfigBool('SearchAdv_ShowCategory')='true'">
              <tr valign="middle">
                <td align="right" valign="middle">
                  <xsl:value-of select="ise:StringResource('AppConfig.CategoryPromptSingular', $LocaleSetting)" disable-output-escaping="yes" />:&#0160;&#0160;
                </td>
                <td align="left">
                  <select onChange="document.AdvSearchForm.submit()" style="font-size: 9px;" size="1" name="CategoryID">
                    <option value="0">
                      <xsl:value-of select="ise:StringResourceTextOnly('searchadv.aspx.9')" disable-output-escaping="yes" />
                    </option>
                    <xsl:for-each select="/root/EntityHelpers/Category/Entity">
                      <xsl:call-template name="EntityOption">
                        <xsl:with-param name="selected" select="/root/QueryString/categoryid" />
                      </xsl:call-template>
                    </xsl:for-each>
                  </select>
                </td>
              </tr>
            </xsl:if>
            <xsl:if test="ise:AppConfigBool('SearchAdv_ShowDepartment')='true'">
              <tr valign="middle">
                <td align="right" valign="middle">
                  <xsl:value-of select="ise:StringResource('AppConfig.DepartmentPromptSingular', $LocaleSetting)" disable-output-escaping="yes" />:&#0160;&#0160;
                </td>
                <td align="left">
                  <select onChange="document.AdvSearchForm.submit()" style="font-size: 9px;" size="1" name="SectionID">
                    <option value="0">
                      <xsl:value-of select="ise:StringResourceTextOnly('searchadv.aspx.9')" disable-output-escaping="yes" />
                    </option>
                    <xsl:for-each select="/root/EntityHelpers/Department/Entity">
                      <xsl:call-template name="EntityOption">
                        <xsl:with-param name="selected" select="/root/QueryString/departmentid" />
                      </xsl:call-template>
                    </xsl:for-each>
                  </select>
                </td>
              </tr>
            </xsl:if>
            <xsl:if test="ise:AppConfigBool('SearchAdv_ShowManufacturer')='true'">
              <tr valign="middle">
                <td align="right" valign="middle">
                  <xsl:value-of select="ise:StringResource('searchadv.aspx.14', $LocaleSetting)" disable-output-escaping="yes" />&#0160;&#0160;
                </td>
                <td align="left">
                  <select onChange="document.AdvSearchForm.submit()" style="font-size: 9px;" size="1" name="ManufacturerID">
                    <option value="0">
                      <xsl:value-of select="ise:StringResourceTextOnly('searchadv.aspx.9')" disable-output-escaping="yes" />
                    </option>
                    <xsl:for-each select="/root/EntityHelpers/Manufacturer/Entity">
                      <xsl:call-template name="EntityOption">
                        <xsl:with-param name="selected" select="/root/QueryString/manufacturerid" />
                      </xsl:call-template>
                    </xsl:for-each>
                  </select>
                </td>
              </tr>
            </xsl:if>              
            <xsl:if test="ise:AppConfigBool('SearchAdv_ShowAttribute')='true'">
                  <tr valign="middle">
                      <td align="right" valign="middle">
                          <xsl:value-of select="ise:StringResource('Attribute', $LocaleSetting)" disable-output-escaping="yes" />
                      </td>
                      <td align="left">
                          <select onChange="document.AdvSearchForm.submit()" style="font-size: 9px;" size="1" name="AttributeID">
                              <option value="0">
                                  <xsl:value-of select="ise:StringResourceTextOnly('searchadv.aspx.9')" disable-output-escaping="yes" />
                              </option>
                              <xsl:for-each select="/root/EntityHelpers/Attribute/Entity">
                                  <xsl:call-template name="EntityOption">
                                      <xsl:with-param name="selected" select="/root/QueryString/attributeid" />
                                  </xsl:call-template>
                              </xsl:for-each>
                          </select>
                      </td>
                  </tr>
            </xsl:if>
            <!-- Display Images -->
            <tr valign="middle">
              <td width="25%" align="right" valign="middle">
                <xsl:value-of select="ise:StringResource('searchadv.aspx.10', $LocaleSetting)" disable-output-escaping="yes" />&#0160;&#0160;
              </td>
              <td align="left">
                <xsl:value-of select="ise:StringResource('searchadv.aspx.5', $LocaleSetting)" disable-output-escaping="yes" />&#0160;<input TYPE="RADIO" NAME="ShowPics" value="1">
                  <xsl:if test="/root/QueryString/showpics = 1">
                    <xsl:attribute name="checked">checked</xsl:attribute>
                  </xsl:if>
                </input>
                <xsl:value-of select="ise:StringResource('searchadv.aspx.6', $LocaleSetting)" disable-output-escaping="yes"/>&#0160;<input TYPE="RADIO" NAME="ShowPics" value="0">
                  <xsl:if test="/root/QueryString/showpics = 0 or not(boolean(/root/QueryString/showpics))">
                    <xsl:attribute name="checked">checked</xsl:attribute>
                  </xsl:if>
                </input>
              </td>
            </tr>
            <xsl:if test="ise:AppConfig('SearchAdv_ShowPriceRange')='true'">
              <tr valign="middle">
                <td width="25%" align="right" valign="middle">
                  <xsl:value-of select="ise:StringResource('searchadv.aspx.11', $LocaleSetting)" disable-output-escaping="yes" />&#0160;&#0160;
                </td>
                <td align="left">
                  <input maxLength="10" size="10" name="MinPrice" value="{/root/QueryString/minprice}" />
                  <input type="hidden" name="MinPrice_vldt">
                    <xsl:attribute name="value">
                      [number][invalidalert=<xsl:value-of select="ise:StringResourceTextOnly('searchadv.aspx.12')" disable-output-escaping="yes" />]
                    </xsl:attribute>
                  </input>
                  &#0160;&#0160;&#0160;<xsl:value-of select="ise:StringResource('searchadv.aspx.13', $LocaleSetting)" disable-output-escaping="yes" />&#0160;&#0160;
                  <input maxLength="10" size="10" name="MaxPrice" value="{/root/QueryString/maxprice}" />
                  <input type="hidden" name="MaxPrice_vldt">
                    <xsl:attribute name="value">
                      [number][invalidalert=<xsl:value-of select="ise:StringResourceTextOnly('searchadv.aspx.12')" disable-output-escaping="yes" />]
                    </xsl:attribute>
                  </input>
                </td>
              </tr>
            </xsl:if>
            <tr>
              <td />
              <td align="left">
                <br />
                <input type="submit" value="{ise:StringResourceTextOnly('search.aspx.1')}" name="SubmitSearch" id="SubmitSearch"
                 class="site-button content"
                 data-contentKey="search.aspx.1"
                 data-contentValue="{ise:StringResourceTextOnly('search.aspx.1')}"
                 data-contentType="string resource"/>
              </td>
            </tr>
          </table>
        </form>

      <xsl:choose>
        <xsl:when test="ise:AppConfigBool('Search_ShowCategoriesInResults')='true' and count(/root/Categories/Category)>0">
          <br />
          <table width="100%" cellpadding="2" cellspacing="0" style="border-style: solid; border-width: 0px; border-color: #444444">
            <tr>
              <td align="left" valign="top">
                <img border="0" src="{concat('skins/Skin_', ise:SkinID(), '/images/matchingcategories.gif')}" />
                <br />
                <table width="100%" cellpadding="4" cellspacing="0" border="0" style="{ise:AppConfig('BoxFrameStyle')}">
                  <tr>
                    <td align="left" valign="top">
                      <xsl:apply-templates select="/root/Categories/Category" />
                    </td>
                  </tr>
                </table>
              </td>
            </tr>
          </table>
        </xsl:when>
        <xsl:when test="ise:AppConfigBool('Search_ShowCategoriesInResults')='true' and count(/root/Categories/Category)=0">
            <p align="left">
              <xsl:value-of select="ise:StringResource('search.aspx.8', $LocaleSetting)" disable-output-escaping="yes" />
              <b />
            </p>
        </xsl:when>
    </xsl:choose>

    <xsl:choose>
        <xsl:when test="ise:AppConfigBool('Search_ShowDepartmentsInResults')='true' and count(/root/Departments/Department)>0">
          <br />
          <table width="100%" cellpadding="2" cellspacing="0" style="border-style: solid; border-width: 0px; border-color: #444444">
            <tr>
              <td align="left" valign="top">
                <img border="0" src="{concat('skins/Skin_', ise:SkinID(), '/images/matchingsections.gif')}" />
                <br />
                <table width="100%" cellpadding="4" cellspacing="0" border="0" style="{ise:AppConfig('BoxFrameStyle')}">
                  <tr>
                    <td align="left" valign="top">
                      <xsl:apply-templates select="/root/Departments/Department" />
                    </td>
                  </tr>
                </table>
              </td>
            </tr>
          </table>
        </xsl:when>
        <xsl:when test="ise:AppConfigBool('Search_ShowDepartmentsInResults')='true' and count(/root/Departments/Department)=0">
            <p align="left">
              <xsl:value-of select="ise:StringResource('search.aspx.8', $LocaleSetting)" disable-output-escaping="yes" />
              <b />
            </p>
        </xsl:when>
   </xsl:choose>

   <xsl:choose>
        <xsl:when test="ise:AppConfigBool('Search_ShowManufacturersInResults')='true' and count(/root/Manufacturers/Manufacturer)>0">
          <br />
          <table width="100%" cellpadding="2" cellspacing="0" style="border-style: solid; border-width: 0px; border-color: #444444">
            <tr>
              <td align="left" valign="top">
                <img border="0" src="{concat('skins/Skin_', ise:SkinID(), '/images/matchingmanufacturers.gif')}" />
                <br />
                <table width="100%" cellpadding="4" cellspacing="0" border="0" style="{ise:AppConfig('BoxFrameStyle')}">
                  <tr>
                    <td align="left" valign="top">
                      <xsl:apply-templates select="/root/Manufacturers/Manufacturer" />
                    </td>
                  </tr>
                </table>
              </td>
            </tr>
          </table>
        </xsl:when>
        <xsl:when test="ise:AppConfigBool('Search_ShowManufacturersInResults')='true' and count(/root/Manufacturers/Manufacturer)=0">
          <p align="left">
            <xsl:value-of select="ise:StringResource('search.aspx.8', $LocaleSetting)" disable-output-escaping="yes" />
         <b />
          </p>
        </xsl:when>
   </xsl:choose>
        
   <xsl:choose>
          <xsl:when test="ise:AppConfigBool('Search_ShowAttributesInResults')='true' and count(/root/Attributes/Attribute)>0">
              <br />
              <table width="100%" cellpadding="2" cellspacing="0" style="border-style: solid; border-width: 0px; border-color: #444444">
                  <tr>
                      <td align="left" valign="top">
                          <img border="0" src="{concat('skins/Skin_', ise:SkinID(), '/images/matchingattributes.gif')}" />
                          <br />
                          <table width="100%" cellpadding="4" cellspacing="0" border="0" style="{ise:AppConfig('BoxFrameStyle')}">
                              <tr>
                                  <td align="left" valign="top">
                                      <table cellpadding="0" border="0" cellspacing="1" width="100%">
                                          <tr>
                                              <td align="left">
                                                  <b>
                                                      <xsl:value-of select="ise:StringResource('search.aspx.9', $LocaleSetting)" disable-output-escaping="yes" />
                                                  </b>
                                              </td>

                                              <td align="left">
                                              <b>
                                                <xsl:value-of select="ise:StringResource('search.aspx.11', $LocaleSetting)" disable-output-escaping="yes" />
                                              </b>
                                            </td>

                                              <td align="left">
                                              <b>
                                                <xsl:value-of select="ise:StringResource('search.aspx.12', $LocaleSetting)" disable-output-escaping="yes" />
                                              </b>
                                            </td>
                                            
                                              <td align="center">
                                                  <b>
                                                      <xsl:value-of select="ise:StringResource('search.aspx.10', $LocaleSetting)" disable-output-escaping="yes" />
                                                  </b>
                                              </td>
                                          </tr>
                                          <xsl:apply-templates select="/root/Attributes/Attribute" />
                                      </table>                                      
                                  </td>
                              </tr>
                          </table>
                      </td>
                  </tr>
              </table>
          </xsl:when>
          <xsl:when test="ise:AppConfigBool('Search_ShowAttributesInResults')='true' and count(/root/Attributes/Attribute)=0">
          <p align="left">
            <xsl:value-of select="ise:StringResource('search.aspx.8', $LocaleSetting)" disable-output-escaping="yes" />
            <b />
          </p>
         </xsl:when>
   </xsl:choose>


   <xsl:choose>
        <xsl:when test="ise:AppConfigBool('Search_ShowProductsInResults')='true' and count(/root/Products/Product)>0">
          <br />
          <table width="100%" cellpadding="2" cellspacing="0" style="{concat('border-style: solid; border-width: 0px; border-color: #', ise:AppConfig('HeaderBGColor'))}">
            <tr>
              <td align="left" valign="top">
                <img align="bottom" border="0" src="{concat('skins/Skin_', ise:SkinID(), '/images/matchingproducts.gif')}" />
                <br />
                <table width="100%" cellpadding="4" cellspacing="0" border="0" style="{ise:AppConfig('BoxFrameStyle')}">
                  <tr>
                    <td align="left" valign="top">
                      <table cellpadding="0" border="0" cellspacing="1" width="100%">
                        <tr>
                          <td align="left">
                            <xsl:if test="/root/QueryString/showpics = 1">
                              <xsl:attribute name="colspan">2</xsl:attribute>
                            </xsl:if>
                            <b>
                              <xsl:value-of select="ise:StringResource('search.aspx.6', $LocaleSetting)" disable-output-escaping="yes" />
                            </b>
                          </td>
                          <td align="center">
                            <b>
                              <xsl:value-of select="ise:StringResource('AppConfig.CategoryPromptSingular', $LocaleSetting)" disable-output-escaping="yes" />
                            </b>
                          </td>
                          <xsl:if test="ise:AppConfigBool('Search_ShowManufacturersInResults')='true'">
                            <td align="center">
                              <b>
                                <xsl:value-of select="ise:StringResource('search.aspx.7', $LocaleSetting)" disable-output-escaping="yes" />
                              </b>
                            </td>
                          </xsl:if>
                        </tr>
                        <xsl:apply-templates select="/root/Products/Product" />
                      </table>
                    </td>
                  </tr>
                </table>
              </td>
            </tr>
          </table>
        </xsl:when>
        <xsl:when test="ise:AppConfigBool('Search_ShowProductsInResults')='true' and count(/root/Products/Product)=0">
          <p align="left">
            <xsl:value-of select="ise:StringResource('search.aspx.8', $LocaleSetting)" disable-output-escaping="yes" />
            <b />
          </p>
        </xsl:when>
    </xsl:choose>
        
        
        <xsl:if test="/root/QueryString/searchterm and count(/root/Categories/Category)=0 and count(/root/Departments/Department)=0 and count(/root/Manufacturers/Manufacturer)=0 and count(/root/Products/Product)=0 and count(/root/Attributes/Attribute)=0">
          <p align="left">
            <xsl:value-of select="ise:StringResource('search.aspx.8', $LocaleSetting)" disable-output-escaping="yes" />
            <b />
          </p>
        </xsl:if>
        
        <script type="text/javascript" Language="JavaScript">
          document.AdvSearchForm.SearchTerm.focus();
        </script>
        <xsl:value-of select="ise:Topic('SearchPageFooter')" disable-output-escaping="yes" />
      </xsl:template>
      
      <xsl:template match="Product">
        <xsl:param name="pName">
          <xsl:choose>
            <xsl:when test="count(Name/ml/locale[@name=$LocaleSetting])!=0">
              <xsl:value-of select="Name/ml/locale[@name=$LocaleSetting]" />
            </xsl:when>
            <xsl:when test="count(Name/ml/locale[@name=$WebConfigLocaleSetting])!=0">
              <xsl:value-of select="Name/ml/locale[@name=$WebConfigLocaleSetting]" />
            </xsl:when>
            <xsl:when test="count(Name/ml)=0">
              <xsl:value-of select="ItemName" />
            </xsl:when>
          </xsl:choose>
        </xsl:param>
        <xsl:param name="vName">
          <xsl:choose>
            <xsl:when test="count(VariantName/ml/locale[@name=$LocaleSetting])!=0">
              <xsl:value-of select="Name/ml/locale[@name=$LocaleSetting]" />
            </xsl:when>
            <xsl:when test="count(VariantName/ml/locale[@name=$WebConfigLocaleSetting])!=0">
              <xsl:value-of select="VariantName/ml/locale[@name=$WebConfigLocaleSetting]" />
            </xsl:when>
            <xsl:when test="count(VariantName/ml)=0">
              <xsl:value-of select="VariantName" />
            </xsl:when>
          </xsl:choose>
        </xsl:param>
        <xsl:param name="pDisplayName">
          <xsl:choose>
            <xsl:when test="string-length(ItemDescription)>0">
              <xsl:value-of select="ItemDescription" />
            </xsl:when>
            <xsl:otherwise>
              <xsl:value-of select="ItemName" />
            </xsl:otherwise>
          </xsl:choose>
        </xsl:param>
        <xsl:variable name="Price" select="ise:GetPriceForAdvanceSearch(ItemCode)" />
        <xsl:if test="$Price&gt;=$MinPrice and $Price&lt;=$MaxPrice">
          <xsl:if test="position()!=1">
            <tr>
              <td height="1" width="100%" class="LightCell">
                <xsl:attribute name="colspan">
                  <xsl:choose>
                    <xsl:when test="ise:AppConfigBool('Search_ShowManufacturersInResults')='true'">5</xsl:when>
                    <xsl:otherwise>4</xsl:otherwise>
                  </xsl:choose>
                </xsl:attribute>
                <img src="images/spacer.gif" height="1" width="1" />
              </td>
            </tr>
          </xsl:if>
          <tr>
            <xsl:if test="/root/QueryString/showpics = 1">
              <td valign="middle" align="left">
                <a href="{concat('p-',Counter,'-',ise:FormatStringForLink($pDisplayName),'.aspx')}">
                <!--<a href="{ise:ProductLink(Counter, ise:FormatStringForLink($pDisplayName), 0, '')}">-->
                  <xsl:value-of select="ise:DisplayImage('product', Counter, 'icon', SEAltText, 'AltText')" disable-output-escaping="yes" />
                </a>&#0160;
              </td>
            </xsl:if>
            <td valign="middle" align="left">

              <a href="{ise:MakeEntityLink('product',Counter,$pDisplayName)}">
                <xsl:value-of select="ise:Encode($pDisplayName)" disable-output-escaping="yes" />
                <xsl:if test="vName!=''">
                  -<xsl:value-of select="$vName" />
                </xsl:if>
              </a>
              
            </td>
            
            <td align="center">
              <xsl:if test="CategoryID != '' and CategoryDisplayName != ''">
                <a href="{ise:MakeEntityLink('category',CategoryID,CategoryDisplayName)}">
                  <xsl:value-of select="ise:Encode(CategoryDisplayName)" disable-output-escaping="yes" />
                </a>
              </xsl:if>
            </td>
            
            <xsl:if test="ise:AppConfigBool('Search_ShowManufacturersInResults')='true'">
              <td align="center">
                <xsl:if test="ManufacturerID != '' and ManufacturerDisplayName != ''">
                  <a href="{ise:MakeEntityLink('manufacturer',ManufacturerID,ManufacturerDisplayName)}">
                    <xsl:value-of select="ise:Encode(ManufacturerDisplayName)" disable-output-escaping="yes" />
                  </a>
                </xsl:if>
              </td>
            </xsl:if>
          </tr>
        </xsl:if>
      </xsl:template>
      
      <xsl:template match="Category">
        <xsl:param name="CatID" select="CategoryCode" />
        <xsl:for-each select="/root/EntityHelpers/Category/descendant::Entity[Name=$CatID]">
          <tr>
            <td align="left" valign="top">
              <xsl:call-template name="entitybreadcrumb">
                <xsl:with-param name="entityprefix" select="'c'" />
              </xsl:call-template>
            </td>
          </tr>
        </xsl:for-each>
      </xsl:template>
      
      <xsl:template match="Department">
        <xsl:param name="SecID" select="DepartmentCode" />
        <xsl:for-each select="/root/EntityHelpers/Department/descendant::Entity[Name=$SecID]">
          <tr>
            <td align="left" valign="top">
              <xsl:call-template name="entitybreadcrumb">
                <xsl:with-param name="entityprefix" select="'d'" />
              </xsl:call-template>
            </td>
          </tr>
        </xsl:for-each>
      </xsl:template>
      
      <xsl:template match="Manufacturer">
        <xsl:param name="ManID" select="ManufacturerCode" />
        <xsl:for-each select="/root/EntityHelpers/Manufacturer/descendant::Entity[Name=$ManID]">
          <tr>
            <td align="left" valign="top">
              <xsl:call-template name="entitybreadcrumb">
                <xsl:with-param name="entityprefix" select="'m'" />
              </xsl:call-template>
            </td>
          </tr>
        </xsl:for-each>
      </xsl:template>
      
      <xsl:template match="Attribute">
            <xsl:param name="AttID" select="SourceFilterName" />
            
            <xsl:param name="pEntityType">
            <xsl:choose>
            <xsl:when test="string-length(EntityType)>0">
              <xsl:value-of select="EntityType" />
            </xsl:when>
            </xsl:choose>
            </xsl:param>
            
              <tr>
                <td align="left">
                    <a href="{concat('a-',Counter,'-',ise:FormatStringForLink($AttID),'.aspx','?EntityID=',EntityCode,'&amp;','EntityName=',EntityType, '&amp;','atr=', concat(EntityCounter,'-', ise:FormatStringForLink(EntityCode)))}">
                        <xsl:value-of select="ise:Encode($AttID)" disable-output-escaping="yes" />
                    </a>
                </td>

                <td align="left">
                  <xsl:value-of select="EntityType" disable-output-escaping="yes" />
                </td>

                <td align="left">

                  <xsl:if test ="$pEntityType = 'Category'">
                    <a href="{concat('c-',EntityCounter,'-',ise:FormatStringForLink(EntityCode),'.aspx')}">
                      <xsl:value-of select="ise:Encode(EntityCode)" disable-output-escaping="yes" />
                    </a>
                  </xsl:if>

                  <xsl:if test ="$pEntityType = 'Department'">
                    <a href="{concat('d-',EntityCounter,'-',ise:FormatStringForLink(EntityCode),'.aspx')}">
                      <xsl:value-of select="ise:Encode(EntityCode)" disable-output-escaping="yes" />
                    </a>
                  </xsl:if>

                </td>

                <td align="left">
                  <center>
                    <xsl:value-of select="ise:Encode(AttributeName)" disable-output-escaping="yes" />
                  </center>
                </td>
                
            </tr>
        </xsl:template>
      
      <xsl:template match="Distributor">
        <xsl:param name="DistID" select="DistributorID" />
        <xsl:for-each select="/root/EntityHelpers/Distributor/descendant::Entity[EntityID=$DistID]">
          <tr>
            <td align="left" valign="top">
              <xsl:call-template name="entitybreadcrumb">
                <xsl:with-param name="entityprefix" select="'d'" />
              </xsl:call-template>
            </td>
          </tr>
        </xsl:for-each>
      </xsl:template>
      
      <xsl:template name="entitybreadcrumb">
        <xsl:param name="entityprefix" />
        <xsl:for-each select="ancestor-or-self::*[child::SEName and ancestor::EntityHelpers]">
          <xsl:variable name="pEName">
            <xsl:choose>
              <xsl:when test="count(Name/ml/locale[@name=$LocaleSetting])!=0">
                <xsl:value-of select="Name/ml/locale[@name=$LocaleSetting]" />
              </xsl:when>
              <xsl:when test="count(Name/ml/locale[@name=$WebConfigLocaleSetting])!=0">
                <xsl:value-of select="Name/ml/locale[@name=$WebConfigLocaleSetting]" />
              </xsl:when>
              <xsl:when test="count(Name/ml)=0">
                <xsl:value-of select="ise:GetMLValue(Description)" />
              </xsl:when>
            </xsl:choose>
          </xsl:variable>
          <a href="{concat($entityprefix, '-', EntityID, '-', ise:FormatStringForLink(SEName), '.aspx')}">
            <xsl:value-of select="$pEName" />
          </a>&#0160;<xsl:if test="position()!=last()">-</xsl:if>&#0160;
        </xsl:for-each>
      </xsl:template>
      <xsl:template match="ItemType">
        <option value="{ItemType}">
          <xsl:if test="ItemType=/root/QueryString/itemtype">
            <xsl:attribute name="selected">selected</xsl:attribute>
          </xsl:if>
          <xsl:value-of select="ItemType" />
        </option>
      </xsl:template>
      <xsl:template match="UnitMeasure">
        <option value="{UnitMeasureCode}">
          <xsl:if test="UnitMeasureCode=/root/QueryString/unitmeasure">
            <xsl:attribute name="selected">selected</xsl:attribute>
          </xsl:if>
          <xsl:value-of select="UnitMeasureDescription" />
        </option>
      </xsl:template>
      <xsl:template name="EntityOption">
        <xsl:param name="prefix" />
        <xsl:param name="selected" />
        <xsl:param name="eName">
          <xsl:choose>
            <xsl:when test="count(Name/ml/locale[@name=$LocaleSetting])!=0">
              <xsl:value-of select="Name/ml/locale[@name=$LocaleSetting]" />
            </xsl:when>
            <xsl:when test="count(Name/ml/locale[@name=$WebConfigLocaleSetting])!=0">
              <xsl:value-of select="Name/ml/locale[@name=$WebConfigLocaleSetting]" />
            </xsl:when>
            <xsl:when test="count(Name/ml)=0">
              <xsl:value-of select="Name" />
            </xsl:when>
          </xsl:choose>
        </xsl:param>
        <option value="{EntityID}">
          <xsl:if test="$selected=EntityID">
            <xsl:attribute name="selected">selected</xsl:attribute>
          </xsl:if>
          <xsl:value-of select="concat($prefix, $eName)" />
        </option>
        <xsl:for-each select="Entity">
          <xsl:call-template name="EntityOption">
            <xsl:with-param name="prefix" select="concat($prefix, $eName, ' -&gt; ')" />
            <xsl:with-param name="selected" select="$selected" />
          </xsl:call-template>
        </xsl:for-each>
      </xsl:template>
    </xsl:stylesheet>
  </PackageTransform>
</package>












